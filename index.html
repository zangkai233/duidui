<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>发圈对对碰 - 登录注册</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f0f2f5; padding: 20px; }
    .container { max-width: 400px; margin: auto; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    h2 { text-align: center; margin-bottom: 20px; }
    input { width: 100%; padding: 8px; margin: 8px 0; }
    button { width: 100%; padding: 10px; margin: 10px 0; }
    #userDashboard, #adminDashboard { display: none; }
  </style>
</head>
<body>
  <div class="container">
    <div id="loginView">
      <h2>登录</h2>
      <input id="loginPhone" placeholder="手机号"><br>
      <input id="loginPass" type="password" placeholder="密码"><br>
      <button id="loginBtn">登录</button>
      <p>没有账号？<a href="#" onclick="showRegister()">注册</a></p>
    </div>

    <div id="registerView" style="display:none">
      <h2>注册</h2>
      <input id="regPhone" placeholder="手机号"><br>
      <input id="regPass" type="password" placeholder="密码"><br>
      <button id="registerBtn">注册</button>
      <p>已有账号？<a href="#" onclick="showLogin()">登录</a></p>
    </div>

    <div id="userDashboard">
      <h2>欢迎回来！</h2>
      <p id="userInfo"></p>
    </div>

    <div id="adminDashboard">
      <h2>管理员后台</h2>
      <p>（后续开发）</p>
    </div>
  </div>

<script>
const apiBase = 'https://api.duidui.uk';

function showLogin() {
  document.getElementById('loginView').style.display = 'block';
  document.getElementById('registerView').style.display = 'none';
  document.getElementById('userDashboard').style.display = 'none';
}

function showRegister() {
  document.getElementById('loginView').style.display = 'none';
  document.getElementById('registerView').style.display = 'block';
  document.getElementById('userDashboard').style.display = 'none';
}

function showUserDashboard(user) {
  document.getElementById('loginView').style.display = 'none';
  document.getElementById('registerView').style.display = 'none';
  document.getElementById('userDashboard').style.display = 'block';
  document.getElementById('userInfo').innerHTML = `手机号: ${user.phone}<br>余额: ${user.balance}`;
}

// 注册按钮点击
document.getElementById('registerBtn').onclick = async () => {
  const phone = document.getElementById('regPhone').value.trim();
  const pass = document.getElementById('regPass').value;
  if (!phone || !pass) return alert('请填写手机号和密码');

  try {
    const res = await fetch(apiBase + '/register', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ phone: phone, password: pass })
    });
    const data = await res.json();
    if (data.status === 'success') {
      alert('注册成功，请登录');
      showLogin();
    } else {
      alert(data.message);
    }
  } catch (err) {
    console.error(err);
    alert('注册失败，请稍后重试');
  }
};

// 登录按钮点击
document.getElementById('loginBtn').onclick = async () => {
  const phone = document.getElementById('loginPhone').value.trim();
  const pass = document.getElementById('loginPass').value;

  try {
    const res = await fetch(apiBase + '/login', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ phone: phone, password: pass })
    });
    const data = await res.json();
    if (data.status === 'success') {
      sessionStorage.setItem('currentUser', JSON.stringify({ phone: phone, role: 'user', balance: data.balance }));
      showUserDashboard({ phone: phone, balance: data.balance });
    } else {
      alert(data.message);
    }
  } catch (err) {
    console.error(err);
    alert('登录失败，请稍后重试');
  }
};
</script>

</body>
</html>
